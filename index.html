<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TITAN ALADDIN V3 | NIXON COMMAND</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;500;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --gold: #D4AF37;
            --deep-black: #050505;
            --terminal-green: #10b981;
        }
        body { 
            background-color: var(--deep-black); 
            color: #e4e4e7; 
            font-family: 'Space Grotesk', sans-serif;
            overflow: hidden;
        }
        .mono { font-family: 'JetBrains Mono', monospace; }
        .terminal-container {
            border: 1px solid rgba(212, 175, 55, 0.2);
            box-shadow: 0 0 50px rgba(0,0,0,0.8), inset 0 0 20px rgba(212, 175, 55, 0.05);
        }
        .gold-glow { text-shadow: 0 0 15px rgba(214, 175, 55, 0.6); }
        .scanline {
            width: 100%;
            height: 3px;
            background: rgba(214, 175, 55, 0.15);
            position: absolute;
            animation: scan 6s linear infinite;
            z-index: 50;
            pointer-events: none;
        }
        @keyframes scan {
            from { top: 0; }
            to { top: 100%; }
        }
        .loading-bar {
            width: 0%;
            height: 100%;
            background: var(--gold);
            transition: width 0.4s ease;
            box-shadow: 0 0 10px var(--gold);
        }
        /* Scrollbar táctica */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #09090b; }
        ::-webkit-scrollbar-thumb { background: #3f3f46; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--gold); }
    </style>
</head>
<body class="h-screen flex flex-col p-2 md:p-6 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-zinc-900 via-black to-black selection:bg-yellow-500/30">

    <div class="scanline"></div>

    <div class="max-w-7xl mx-auto w-full h-full flex flex-col gap-4 relative z-10">
        <div class="flex flex-col md:flex-row justify-between items-end border-b border-zinc-800 pb-4">
            <div>
                <h1 class="text-4xl md:text-5xl font-black tracking-tighter italic text-white flex items-center gap-3">
                    <span class="bg-gradient-to-r from-yellow-700 to-yellow-500 text-black px-3 skew-x-[-10deg] not-italic shadow-[0_0_15px_rgba(234,179,8,0.5)]">TITÁN</span>
                    <span class="text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 to-yellow-600 gold-glow">ALADDIN V3</span>
                </h1>
                <p class="mono text-[10px] text-zinc-500 mt-2 tracking-[0.4em] uppercase font-bold">
                    SYSTEM: GEMINI-3-FLASH | STATUS: OPERATIONAL
                </p>
            </div>
            <div class="text-right hidden md:block">
                <p class="mono text-[10px] text-yellow-600 font-bold uppercase tracking-widest border border-yellow-900/30 px-2 py-1 rounded">
                    DIRECTOR NIXON // ACCESO NIVEL 5
                </p>
                <p id="clock" class="mono text-xs text-zinc-400 mt-1 uppercase"></p>
            </div>
        </div>

        <div class="flex-1 grid grid-cols-1 lg:grid-cols-12 gap-6 min-h-0">
            
            <div class="lg:col-span-4 flex flex-col gap-4">
                <div class="terminal-container bg-zinc-950/90 p-6 rounded-xl flex flex-col h-full backdrop-blur-sm">
                    <div class="flex items-center justify-between mb-4 border-b border-zinc-800/50 pb-2">
                        <label class="text-[10px] font-bold text-yellow-600 uppercase tracking-widest flex items-center gap-2">
                            <span class="relative flex h-2 w-2">
                              <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-yellow-400 opacity-75"></span>
                              <span class="relative inline-flex rounded-full h-2 w-2 bg-yellow-500"></span>
                            </span>
                            Entrada de Comando
                        </label>
                        <span class="text-[9px] text-zinc-600 mono">SECURE_CHANNEL_01</span>
                    </div>
                    
                    <textarea id="userInput" 
                        class="flex-1 bg-zinc-900/30 rounded border border-zinc-800 text-zinc-200 mono text-sm focus:ring-1 focus:ring-yellow-600/50 focus:border-yellow-600/50 resize-none p-4 placeholder-zinc-700 transition-all"
                        placeholder="Ingrese activo o consulta estratégica..."></textarea>
                    
                    <div class="mt-6 flex flex-col gap-3">
                        <div class="h-1.5 bg-zinc-900 rounded-full overflow-hidden border border-zinc-800">
                            <div id="loadingIndicator" class="loading-bar"></div>
                        </div>
                        <button id="execBtn" onclick="execute()" 
                            class="w-full bg-gradient-to-r from-yellow-700 to-yellow-600 hover:from-yellow-600 hover:to-yellow-500 text-black font-black py-4 rounded shadow-[0_0_20px_rgba(202,138,4,0.2)] uppercase tracking-widest text-xs transition-all active:scale-[0.98] border border-yellow-400/20">
                            EJECUTAR ANÁLISIS V3
                        </button>
                    </div>
                </div>
            </div>

            <div class="lg:col-span-8 flex flex-col h-full min-h-0">
                <div class="terminal-container bg-black/90 rounded-xl flex flex-col h-full overflow-hidden relative">
                    <div class="absolute top-0 right-0 p-4 opacity-20 pointer-events-none">
                        <svg width="100" height="100" viewBox="0 0 100 100" fill="none" stroke="#D4AF37" stroke-width="0.5">
                            <circle cx="50" cy="50" r="40" stroke-dasharray="4 4" />
                            <circle cx="50" cy="50" r="20" />
                            <line x1="50" y1="0" x2="50" y2="100" />
                            <line x1="0" y1="50" x2="100" y2="50" />
                        </svg>
                    </div>

                    <div class="bg-zinc-900/60 px-5 py-3 flex justify-between items-center border-b border-zinc-800 backdrop-blur">
                        <div class="flex gap-2">
                            <div class="w-2.5 h-2.5 rounded-full bg-zinc-700 border border-zinc-600"></div>
                            <div class="w-2.5 h-2.5 rounded-full bg-zinc-700 border border-zinc-600"></div>
                        </div>
                        <span class="text-[9px] mono text-yellow-600/70 tracking-[0.2em] uppercase font-bold">
                            <i class="mr-2">⚡</i>Gemini 3 Flash Connected
                        </span>
                    </div>

                    <div id="outputDisplay" class="p-8 overflow-y-auto flex-1 mono text-sm leading-relaxed scroll-smooth">
                        <div class="text-zinc-600 flex flex-col gap-2 h-full justify-center items-center opacity-50">
                            <p class="animate-pulse tracking-widest">> SISTEMA EN ESPERA</p>
                        </div>
                    </div>

                    <div id="sources" class="px-6 py-4 bg-zinc-950 border-t border-zinc-800/50 flex flex-wrap gap-4 text-[9px] text-zinc-500 uppercase min-h-[3rem]">
                        </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 1. RELOJ TÁCTICO
        function updateClock() {
            const now = new Date();
            document.getElementById('clock').innerText = now.toLocaleString('es-ES', { 
                hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false 
            }) + " ZULU";
        }
        setInterval(updateClock, 1000);
        updateClock();

        // ==========================================
        //      ZONA DE CREDENCIALES (MODIFICAR)
        // ==========================================
        
        // ⚠️ PEGA TU CLAVE AQUÍ ABAJO (Dentro de las comillas)
        const apiKey = "AIzaSyB3KzzyScDck44l8p7ovuEtU6YzdGNrGlk"; 
        
        // MOTOR ACTUALIZADO (DICIEMBRE 2025 - Informe Gemini 3)
        const modelName = "gemini-3-flash-preview"; 

        // ==========================================

        async function execute() {
            const input = document.getElementById('userInput').value;
            const output = document.getElementById('outputDisplay');
            const btn = document.getElementById('execBtn');
            const loader = document.getElementById('loadingIndicator');
            const sourcesDiv = document.getElementById('sources');

            if (!input.trim()) return;
            if (apiKey === "AIzaSyB3KzzyScDck44l8p7ovuEtU6YzdGNrGlk" || apiKey === "") {
                alert("⛔ ERROR DE SEGURIDAD: Debes pegar tu API KEY en el código (Línea 136)");
                return;
            }

            // ESTADO: CARGANDO
            btn.disabled = true;
            btn.innerHTML = `<span class="animate-pulse">PROCESANDO DATOS...</span>`;
            loader.style.width = "45%";
            sourcesDiv.innerHTML = "";
            
            output.innerHTML = `
                <div class="flex flex-col gap-2 font-mono text-xs text-yellow-600/80 mt-4">
                    <p>> Inicializando Gemini 3 Flash...</p>
                    <p>> Bypassing Latency Protocols...</p>
                    <p>> Real-time Grounding (Google Search) ACTIVO...</p>
                    <div class="mt-4 p-2 border border-yellow-900/30 bg-yellow-900/10 rounded w-fit animate-pulse">
                        > Analizando: "${input}"
                    </div>
                </div>`;

            // INSTRUCCIÓN MAESTRA (Director Nixon)
            const systemPrompt = `
            ACTÚA COMO: TITÁN ALADDIN (Sistema de Inteligencia Financiera Soberana).
            USUARIO: Director Nixon.
            
            OBJETIVO:
            Proporcionar análisis de mercado de alta precisión, sin rodeos, con datos actualizados.
            
            REGLAS:
            1. Usa Google Search para obtener el PRECIO EXACTO ACTUAL.
            2. Analiza el Sentimiento y la Estructura Técnica.
            3. Da una ORDEN FINAL (ACUMULAR / VENDER / ESPERAR).
            4. Formato de salida: Markdown limpio. Usa tablas para números.
            5. Tono: Profesional, Militar, Ejecutivo.
            `;

            let retries = 3;

            async function callAI() {
                const url = `https://generativelanguage.googleapis.com/v1beta/models/${modelName}:generateContent?key=${apiKey}`;
                
                const payload = {
                    contents: [{ parts: [{ text: input }] }],
                    systemInstruction: { parts: [{ text: systemPrompt }] },
                    // Herramienta de Búsqueda de Google (Grounded)
                    tools: [{ "google_search": {} }]
                };

                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    // Manejo de error 503 (Sobrecarga) o 429
                    if (response.status >= 500 && retries > 0) {
                        retries--;
                        await new Promise(r => setTimeout(r, 2000));
                        return callAI();
                    }
                    const errData = await response.json();
                    throw new Error(errData.error?.message || `HTTP ${response.status}`);
                }
                return await response.json();
            }

            try {
                const data = await callAI();
                loader.style.width = "85%";

                // Extracción de datos
                const text = data.candidates?.[0]?.content?.parts?.[0]?.text || "⚠️ EL ORÁCULO NO RESPONDIÓ.";
                
                // Fuentes (Grounding)
                const attributions = data.candidates?.[0]?.groundingMetadata?.groundingAttributions || [];

                loader.style.width = "100%";
                
                // Renderizado Final
                // Convertimos Markdown básico a HTML simple para visualización
                let formattedText = text
                    .replace(/\*\*(.*?)\*\*/g, '<strong class="text-yellow-500">$1</strong>') // Negritas doradas
                    .replace(/^# (.*$)/gim, '<h2 class="text-xl font-bold text-white border-b border-zinc-700 pb-2 mb-4 mt-2">$1</h2>') // Títulos
                    .replace(/\n/g, '<br>');

                output.innerHTML = `
                    <div class="animate-in fade-in duration-700">
                        <div class="text-zinc-300 leading-relaxed">${formattedText}</div>
                    </div>
                `;

                // Renderizado de Fuentes
                if (attributions.length > 0) {
                    sourcesDiv.innerHTML = `<span class="text-yellow-600 font-bold tracking-wider">FUENTES VERIFICADAS:</span>`;
                    attributions.forEach((attr, idx) => {
                        const url = attr.web?.uri;
                        const title = attr.web?.title || "Fuente Externa";
                        if (url) {
                            sourcesDiv.innerHTML += `
                                <a href="${url}" target="_blank" class="flex items-center gap-1 hover:text-white transition-colors bg-zinc-900 px-2 py-1 rounded border border-zinc-800 hover:border-yellow-600/50">
                                    <span class="text-yellow-600">[${idx+1}]</span> ${title.substring(0, 25)}...
                                </a>`;
                        }
                    });
                }

            } catch (err) {
                console.error(err);
                output.innerHTML = `
                    <div class="border-l-2 border-red-600 bg-red-900/10 p-6 rounded text-red-400 mono text-xs mt-4">
                        <h3 class="font-bold text-lg mb-2">⛔ FALLO DE SISTEMA</h3>
                        <p class="mb-2">CODE: ${err.message}</p>
                        <p class="text-zinc-500">SUGERENCIA: Verifica que la API KEY sea correcta y que el modelo "gemini-3-flash-preview" esté habilitado en tu cuenta.</p>
                    </div>`;
            } finally {
                setTimeout(() => { loader.style.width = "0%"; }, 800);
                btn.disabled = false;
                btn.innerText = "EJECUTAR ANÁLISIS V3";
            }
        }
    </script>
</body>
</html>
