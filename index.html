<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TITAN ALADDIN V3 | NIXON COMMAND</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;500;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --gold: #D4AF37; --deep-black: #050505; --terminal-green: #10b981; }
        body { background-color: var(--deep-black); color: #e4e4e7; font-family: 'Space Grotesk', sans-serif; overflow: hidden; }
        .mono { font-family: 'JetBrains Mono', monospace; }
        .terminal-container { border: 1px solid rgba(212, 175, 55, 0.2); box-shadow: 0 0 50px rgba(0,0,0,0.8), inset 0 0 20px rgba(212, 175, 55, 0.05); }
        .gold-glow { text-shadow: 0 0 15px rgba(214, 175, 55, 0.6); }
        /* Efecto de Escaneo Láser */
        .scanline { width: 100%; height: 3px; background: rgba(214, 175, 55, 0.15); position: absolute; animation: scan 6s linear infinite; z-index: 50; pointer-events: none; }
        @keyframes scan { from { top: 0; } to { top: 100%; } }
        .loading-bar { width: 0%; height: 100%; background: var(--gold); transition: width 0.4s ease; box-shadow: 0 0 10px var(--gold); }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #09090b; }
        ::-webkit-scrollbar-thumb { background: #3f3f46; border-radius: 3px; }
    </style>
</head>
<body class="h-screen flex flex-col p-2 md:p-6 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-zinc-900 via-black to-black">

    <div class="scanline"></div>

    <div class="max-w-7xl mx-auto w-full h-full flex flex-col gap-4 relative z-10">
        <div class="flex flex-col md:flex-row justify-between items-end border-b border-zinc-800 pb-4">
            <div>
                <h1 class="text-4xl md:text-5xl font-black tracking-tighter italic text-white flex items-center gap-3">
                    <span class="bg-gradient-to-r from-yellow-700 to-yellow-500 text-black px-3 skew-x-[-10deg] not-italic shadow-[0_0_15px_rgba(234,179,8,0.5)]">TITÁN</span>
                    <span class="text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 to-yellow-600 gold-glow">ALADDIN V3</span>
                </h1>
                <p class="mono text-[10px] text-zinc-500 mt-2 tracking-[0.4em] uppercase font-bold">SYSTEM: TITAN-CORE | STATUS: ONLINE</p>
            </div>
            <div class="text-right hidden md:block">
                <p class="mono text-[10px] text-yellow-600 font-bold uppercase tracking-widest border border-yellow-900/30 px-2 py-1 rounded">DIRECTOR NIXON // ACCESO NIVEL 5</p>
                <p id="clock" class="mono text-xs text-zinc-400 mt-1 uppercase"></p>
            </div>
        </div>

        <div class="flex-1 grid grid-cols-1 lg:grid-cols-12 gap-6 min-h-0">
            
            <div class="lg:col-span-4 flex flex-col gap-4">
                <div class="terminal-container bg-zinc-950/90 p-6 rounded-xl flex flex-col h-full backdrop-blur-sm">
                    <div class="flex items-center justify-between mb-4 border-b border-zinc-800/50 pb-2">
                        <label class="text-[10px] font-bold text-yellow-600 uppercase tracking-widest flex items-center gap-2">
                            <span class="relative flex h-2 w-2">
                              <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-yellow-400 opacity-75"></span>
                              <span class="relative inline-flex rounded-full h-2 w-2 bg-yellow-500"></span>
                            </span>
                            Entrada de Comando
                        </label>
                        <span class="text-[9px] text-zinc-600 mono">SECURE_CHANNEL_01</span>
                    </div>
                    
                    <textarea id="userInput" 
                        class="flex-1 bg-zinc-900/30 rounded border border-zinc-800 text-zinc-200 mono text-sm focus:ring-1 focus:ring-yellow-600/50 focus:border-yellow-600/50 resize-none p-4 placeholder-zinc-700 transition-all font-bold text-xl uppercase"
                        placeholder="EJ: BTC-USD">BTC-USD</textarea>
                    
                    <div class="mt-6 flex flex-col gap-3">
                        <div class="h-1.5 bg-zinc-900 rounded-full overflow-hidden border border-zinc-800">
                            <div id="loadingIndicator" class="loading-bar"></div>
                        </div>
                        <button id="execBtn" onclick="execute()" 
                            class="w-full bg-gradient-to-r from-yellow-700 to-yellow-600 hover:from-yellow-600 hover:to-yellow-500 text-black font-black py-4 rounded shadow-[0_0_20px_rgba(202,138,4,0.2)] uppercase tracking-widest text-xs transition-all active:scale-[0.98] border border-yellow-400/20">
                            EJECUTAR ANÁLISIS V3
                        </button>
                    </div>
                </div>
            </div>

            <div class="lg:col-span-8 flex flex-col h-full min-h-0">
                <div class="terminal-container bg-black/90 rounded-xl flex flex-col h-full overflow-hidden relative">
                    
                    <div class="grid grid-cols-3 border-b border-zinc-800 bg-zinc-900/50">
                        <div class="p-4 border-r border-zinc-800 text-center">
                            <p class="text-[9px] text-zinc-500 uppercase">PRECIO ACTUAL</p>
                            <p id="uiPrice" class="text-xl md:text-2xl font-bold text-white mt-1">---</p>
                        </div>
                        <div class="p-4 border-r border-zinc-800 text-center">
                            <p class="text-[9px] text-zinc-500 uppercase">RSI (FUERZA)</p>
                            <p id="uiRSI" class="text-xl md:text-2xl font-bold text-blue-400 mt-1">---</p>
                        </div>
                        <div class="p-4 text-center relative overflow-hidden">
                            <div class="absolute inset-0 bg-yellow-600/5"></div>
                            <p class="text-[9px] text-yellow-600 uppercase relative z-10">ORDEN IA</p>
                            <p id="uiSignal" class="text-xl md:text-2xl font-bold text-white mt-1 relative z-10">ESPERANDO</p>
                        </div>
                    </div>

                    <div id="outputDisplay" class="p-8 overflow-y-auto flex-1 mono text-sm leading-relaxed scroll-smooth relative">
                         <div id="internalLoader" class="hidden absolute inset-0 bg-black/80 flex flex-col items-center justify-center z-20">
                            <div class="text-yellow-500 animate-pulse font-bold tracking-widest">PROCESANDO INTELIGENCIA...</div>
                         </div>
                        <div id="logText" class="text-zinc-500 opacity-50 text-xs">
                            > CONSOLA LISTA.<br>> ESPERANDO INSTRUCCIONES DEL DIRECTOR...
                        </div>
                    </div>

                    <div id="sources" class="px-6 py-4 bg-zinc-950 border-t border-zinc-800/50 flex flex-wrap gap-4 text-[9px] text-zinc-500 uppercase min-h-[3rem]">
                        <span class="text-green-900">FUENTE: YAHOO FINANCE GLOBAL PROTOCOL</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 1. RELOJ EN TIEMPO REAL
        function updateClock() {
            const now = new Date();
            document.getElementById('clock').innerText = now.toLocaleString('es-ES', { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false }) + " ZULU";
        }
        setInterval(updateClock, 1000);
        updateClock();

        // 2. FUNCIÓN DE EJECUCIÓN (LA SOLDADURA)
        async function execute() {
            const input = document.getElementById('userInput').value.trim();
            const output = document.getElementById('logText');
            const btn = document.getElementById('execBtn');
            const loader = document.getElementById('loadingIndicator');
            const internalLoader = document.getElementById('internalLoader');

            if (!input) return;

            // UI ESTADO: CARGANDO
            btn.disabled = true;
            btn.innerHTML = "CONECTANDO CON NÚCLEO...";
            loader.style.width = "60%";
            internalLoader.classList.remove('hidden');
            output.innerHTML = `<span class="text-yellow-600">> INICIANDO PROTOCOLO PARA ${input}...</span><br>`;

            try {
                // --- AQUÍ OCURRE LA MAGIA ---
                // La página web llama a tu motor Python interno (/aladdin)
                // No usa API Keys en el navegador, usa el servidor seguro.
                const response = await fetch(`/aladdin/${input}`);
                const data = await response.json();
                
                loader.style.width = "100%";
                
                if (data.error) throw new Error(data.error);

                // --- ACTUALIZAR TARJETAS VISUALES ---
                if (data.technical_analysis) {
                    // Precio
                    document.getElementById('uiPrice').innerText = "$" + data.technical_analysis.price.toLocaleString();
                    
                    // RSI (Color dinámico)
                    const rsi = data.technical_analysis.rsi.toFixed(2);
                    const rsiEl = document.getElementById('uiRSI');
                    rsiEl.innerText = rsi;
                    rsiEl.className = rsi > 70 ? "text-xl md:text-2xl font-bold text-red-500 mt-1" : (rsi < 30 ? "text-xl md:text-2xl font-bold text-green-500 mt-1" : "text-xl md:text-2xl font-bold text-blue-400 mt-1");

                    // Señal (Compra/Venta)
                    const signal = data.suggestion || "NEUTRAL";
                    const signalEl = document.getElementById('uiSignal');
                    signalEl.innerText = signal.toUpperCase();
                    
                    if(signal.includes("VENTA")) signalEl.className = "text-xl md:text-2xl font-bold text-red-500 mt-1 animate-pulse relative z-10";
                    else if(signal.includes("COMPRA")) signalEl.className = "text-xl md:text-2xl font-bold text-green-500 mt-1 animate-pulse relative z-10";
                    else signalEl.className = "text-xl md:text-2xl font-bold text-white mt-1 relative z-10";
                    
                    // --- MOSTRAR LOG DETALLADO EN LA CONSOLA ---
                    output.innerHTML += `<span class="text-green-500">> ANÁLISIS COMPLETADO.</span><br><br>`;
                    // Imprimimos el JSON bonito
                    output.innerHTML += `<div class="text-zinc-300 whitespace-pre-wrap">${JSON.stringify(data, null, 2)}</div>`;
                }

            } catch (err) {
                console.error(err);
                output.innerHTML += `<br><span class="text-red-500 bg-red-900/20 px-2">❌ ERROR CRÍTICO: ${err.message}</span>`;
            } finally {
                setTimeout(() => { loader.style.width = "0%"; }, 800);
                internalLoader.classList.add('hidden');
                btn.disabled = false;
                btn.innerText = "EJECUTAR ANÁLISIS V3";
            }
        }
    </script>
</body>
</html>
